// Automatically generated by tomatebase-cli

import { FsMappable, IpcCall } from ".";

export default class ShadowFsMap<Value extends FsMappable> {
  static className = 'FsMap';
  ipcCall: IpcCall;
  data: { path: string };
  entries: {
    [key: string]: Value;
  };
  constructor(
    ipcCall: IpcCall,
    data: {
      entries: { [key: string]: Value };
      data: { path: string };
    }
  ) {
    this.ipcCall = ipcCall;
    this.entries = data.entries;
    this.data = data.data;
  }
  get(id: string) {
    return this.entries[id];
  }

  async set(id: string, value: Omit<Value, 'id' | 'folder'>): Promise<void> {
    await this.ipcCall('db-function', 'FsMap', 'set', [id, value]);
    let entry: any = value;
    entry.folder = `${this.data.path}/${id}`;
    entry.id = id;
    this.entries[id] = entry;
  }

  async remove(id: string): Promise<void> {
    await this.ipcCall('db-function', 'FsMap', 'remove', [id]);
    delete this.entries[id];
  }

  list() {
    return Object.values(this.entries);
  }

  length() {
    return Object.keys(this.entries).length;
  }

  async add(value: Omit<Value, 'id'>): Promise<Value> {
    const entry = await this.ipcCall('db-function', 'FsMap', 'add', [value]);
    this.set(entry.id, entry);
    return entry;
  }

  toJSON() {
    this.ipcCall('db-function', 'FsMap', 'toJSON', arguments);
  }

  toClientJSON() {
    this.ipcCall('db-function', 'FsMap', 'toClientJSON', arguments);
  }
}
